<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Influencer Scraper Pro</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">INFLUENCER <span>SCRAPER</span></div>
            <div class="status" id="status">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">V√©rification...</span>
            </div>
        </header>

        <!-- Main content -->
        <main class="main">
            <!-- Hero section -->
            <div class="hero">
                <h1>Analysez n'importe quel influenceur</h1>
                <p>Instagram ¬∑ TikTok ¬∑ YouTube ¬∑ Donn√©es en temps r√©el</p>
            </div>

            <!-- Search card -->
            <div class="search-card">
                <div class="search-header">
                    <h2>üîç Rechercher un influenceur</h2>
                </div>
                
                <div class="search-box">
                    <input type="text" 
                           id="username" 
                           placeholder="@leomessi ou URL compl√®te"
                           class="search-input">
                    
                    <select id="platform" class="platform-select">
                        <option value="auto">üåê Auto-d√©tection</option>
                        <option value="instagram">üì∑ Instagram</option>
                        <option value="tiktok">üéµ TikTok</option>
                        <option value="youtube">‚ñ∂Ô∏è YouTube</option>
                    </select>
                    
                    <button onclick="analyze()" id="analyzeBtn" class="search-btn">
                        ANALYSER
                    </button>
                </div>

                <div class="examples">
                    Exemples : @leomessi ¬∑ @charlidamelio ¬∑ @MrBeast
                </div>
            </div>

            <!-- Loading indicator -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyse en cours... Cela peut prendre quelques secondes</p>
            </div>

            <!-- Error message -->
            <div class="error-message" id="errorMessage"></div>

            <!-- Results card -->
            <div class="results-card" id="results">
                <div class="profile-header">
                    <div class="profile-info">
                        <h2 id="profileName">En attente d'analyse</h2>
                        <p id="profileBio" class="profile-bio"></p>
                        <span class="badge" id="profileNiche"></span>
                    </div>
                </div>

                <div class="stats-grid" id="statsGrid">
                    <!-- Les stats seront inject√©es ici -->
                </div>

                <div class="action-buttons">
                    <button onclick="exportPDF()" class="btn-pdf">
                        üìÑ T√©l√©charger rapport PDF
                    </button>
                    <button onclick="resetSearch()" class="btn-reset">
                        ‚Ü∫ Nouvelle recherche
                    </button>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>¬© 2024 Influencer Scraper Pro ¬∑ Donn√©es en temps r√©el</p>
        </footer>
    </div>

    <script>
        // Configuration
        const API_URL = '';  // Vide car m√™me domaine

        // √âtat global
        let currentData = null;

        // V√©rification du serveur au chargement
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/api/health');
                if (response.ok) {
                    setStatus('online', 'Serveur connect√©');
                } else {
                    setStatus('offline', 'Serveur inaccessible');
                }
            } catch (error) {
                setStatus('offline', 'Serveur hors ligne');
            }
        });

        function setStatus(state, text) {
            const dot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            dot.className = 'status-dot ' + state;
            statusText.textContent = text;
        }

        async function analyze() {
            const username = document.getElementById('username').value.trim();
            const platform = document.getElementById('platform').value;
            
            if (!username) {
                showError('Veuillez entrer un pseudo');
                return;
            }

            // UI loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('analyzeBtn').disabled = true;

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, platform })
                });

                const data = await response.json();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('analyzeBtn').disabled = false;

                if (response.ok) {
                    currentData = data;
                    displayResults(data);
                } else {
                    showError(data.error || 'Erreur lors de l\'analyse');
                }
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('analyzeBtn').disabled = false;
                showError('Erreur de connexion au serveur');
            }
        }

        function displayResults(data) {
            document.getElementById('results').style.display = 'block';
            
            if (data.multi) {
                displayMultiResults(data.results);
            } else {
                document.getElementById('profileName').textContent = `@${data.username}`;
                document.getElementById('profileBio').textContent = data.bio || 'Aucune bio disponible';
                document.getElementById('profileNiche').textContent = detectNiche(data.bio || '');
                
                let statsHtml = `
                    <div class="stat-card">
                        <div class="stat-value">${formatNumber(data.followers)}</div>
                        <div class="stat-label">Followers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${formatNumber(data.following || 0)}</div>
                        <div class="stat-label">Abonnements</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${formatNumber(data.posts || 0)}</div>
                        <div class="stat-label">Publications</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${calculateEngagement(data)}%</div>
                        <div class="stat-label">Engagement</div>
                    </div>
                `;
                
                document.getElementById('statsGrid').innerHTML = statsHtml;
            }
        }

        function displayMultiResults(results) {
            document.getElementById('profileName').textContent = 'Multi-plateforme';
            document.getElementById('profileBio').textContent = 
                `R√©sultats sur ${results.length} plateforme(s)`;
            document.getElementById('profileNiche').textContent = 'Analyse compl√®te';
            
            let totalFollowers = 0;
            let statsHtml = '';
            
            results.forEach(r => {
                totalFollowers += r.followers || 0;
                statsHtml += `
                    <div class="stat-card">
                        <div class="stat-value">${formatNumber(r.followers || 0)}</div>
                        <div class="stat-label">${r.platform}</div>
                    </div>
                `;
            });
            
            statsHtml += `
                <div class="stat-card highlight">
                    <div class="stat-value">${formatNumber(totalFollowers)}</div>
                    <div class="stat-label">Total</div>
                </div>
            `;
            
            document.getElementById('statsGrid').innerHTML = statsHtml;
        }

        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
            return num.toString();
        }

        function calculateEngagement(data) {
            if (!data.followers) return '0.0';
            const engagement = ((data.likes || 0) / data.followers * 100).toFixed(1);
            return engagement;
        }

        function detectNiche(bio) {
            bio = bio.toLowerCase();
            if (bio.includes('fitness') || bio.includes('gym') || bio.includes('workout')) 
                return 'üèãÔ∏è Fitness';
            if (bio.includes('travel') || bio.includes('voyage') || bio.includes('trip')) 
                return '‚úàÔ∏è Voyage';
            if (bio.includes('fashion') || bio.includes('mode') || bio.includes('style')) 
                return 'üëó Mode';
            if (bio.includes('tech') || bio.includes('gadget') || bio.includes('iphone')) 
                return 'üíª Tech';
            if (bio.includes('food') || bio.includes('cuisine') || bio.includes('recipe')) 
                return 'üç≥ Cuisine';
            if (bio.includes('gaming') || bio.includes('jeux') || bio.includes('twitch')) 
                return 'üéÆ Gaming';
            return 'üåü G√©n√©ral';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = '‚ùå ' + message;
            errorDiv.style.display = 'block';
        }

        function resetSearch() {
            document.getElementById('username').value = '';
            document.getElementById('results').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
        }

        function exportPDF() {
            if (!currentData) return;
            alert('Fonctionnalit√© PDF √† venir !');
            // Ici tu pourras ajouter l'export PDF plus tard
        }

        // Enter key pour lancer la recherche
        document.getElementById('username').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') analyze();
        });
    </script>
</body>
</html>
